---
import { getCollection } from "astro:content";

import { Anchor } from "~/components/Anchor";
import BodyContents from "~/components/BodyContents.astro";
import HeroTertiary from "~/components/HeroTertiary.astro";
import { SpeakingsTabbed } from "~/components/speaking/SpeakingsTabbed";
import { groupBy } from "~/utils";

import HeroLayout from "../layouts/HeroLayout.astro";

const allSpeakings = await getCollection("speaking");

const categories = {
	All: allSpeakings,
	...groupBy(allSpeakings, (speaking) => speaking.data.category),
};

console.log(
	allSpeakings
		.filter(
			(conference) =>
				conference.data.category === "Conferences" &&
				conference.data.location !== "Online" &&
				conference.data.date.getFullYear() === 2023,
		)
		.toSorted((a, b) => a.data.date - b.data.date)
		.map(({ data }) => {
			return `## ${data.event}

> ${data.date.toLocaleString("default", {
				day: "numeric",
				month: "long",
			})} - ${data.location}
>
> ${data.title}
> ${Object.entries(data.links)
				.map(([a, b]) => `[[${a}](${b} "${data.event} ${a}")]`)
				.join(" ")}
`;
		})
		.join("\n"),
);
---

<HeroLayout
	alt="Josh looking up seriously wearing a dark blue shirt with a small pineapples and flamingos pattern"
	primary="Speaking"
	secondary="I talk about static analysis, accessibility, and team culture."
	title="Speaking"
>
	<HeroTertiary slot="tertiary">
		Want me to speak at your event? Hooray!
		<br />
		 Please see my <Anchor
			href="https://github.com/JoshuaKGoldberg/speaker-rider"
			target="_blank"
		>
			speaker rider
		</Anchor>.
	</HeroTertiary>
	<BodyContents>
		<SpeakingsTabbed categories={categories} client:load />
	</BodyContents>
</HeroLayout>
